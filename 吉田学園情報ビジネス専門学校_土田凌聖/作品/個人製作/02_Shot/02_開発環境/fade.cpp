//==============================================================================================
//
// フェード　　　fade.cpp
// 土田凌聖
//
//==============================================================================================

//**********************************************************************************************
// インクルード
//**********************************************************************************************
#include"fade.h"

//**********************************************************************************************
// 静的メンバ変数の宣言
//**********************************************************************************************
float CFade::m_fFadeSpeed = 0.0f;
CApplication::MODE CFade::NextMode = CApplication::MODE_NONE;
CFade::FADE CFade::FadeMode = FADE_NONE;

//==============================================================================================
// コンストラクタ
//==============================================================================================
CFade::CFade() : CObject2D(5)
{
}

//==============================================================================================
// デストラクタ
//==============================================================================================
CFade::~CFade()
{
}

//==============================================================================================
// 初期化処理
//==============================================================================================
HRESULT CFade::Init(D3DXVECTOR3 pos)
{
	CObject2D::Init(pos);

	m_Pos = pos;				// 初期位置
	m_fWidth = FADE_WIDTH;		// 幅
	m_fHeight = FADE_HEIGHT;	// 高さ
	m_fAlpha = 0.0f;			// アルファ値

	// サイズと幅の設定
	CObject2D::SetSize(m_fWidth, m_fHeight);

	// 色の設定
	CObject2D::SetCol({ 0.0f,0.0f,0.0f,0.0f });

	return S_OK;
}

//==============================================================================================
// 終了処理
//==============================================================================================
void CFade::Uninit()
{
	CObject2D::Uninit();
}

//==============================================================================================
// 更新処理
//==============================================================================================
void CFade::Update()
{
	CObject2D::Update();

	// 色の設定
	CObject2D::SetCol({ 0.0f,0.0f,0.0f,m_fAlpha });

	if (FadeMode != FADE_NONE)
	{
		if (FadeMode == FADE_IN)
		{
			// ポリゴンを透明にしていく
			m_fAlpha -= m_fFadeSpeed;

			if (m_fAlpha <= 0.0f)
			{
				//何もしてない状態にする
				FadeMode = FADE_NONE;

				// 終了処理
				Uninit();
			}
		}
		else if (FadeMode == FADE_OUT)
		{
			//ポリゴンを不透明にしていく
			m_fAlpha += m_fFadeSpeed;

			if (m_fAlpha >= 1.0f)
			{
				// 画面遷移
				CApplication::SetMode(NextMode);

				//フェードイン状態にする
				FadeMode = FADE_IN;
			}
		}
	}
}

//==============================================================================================
// 描画処理
//==============================================================================================
void CFade::Draw()
{
	CObject2D::Draw();
}

//==============================================================================================
// 生成処理
//==============================================================================================
CFade *CFade::Create()
{
	CFade *pFade = nullptr;

	pFade = new CFade;

	if (pFade != nullptr)
	{
		pFade->Init(D3DXVECTOR3(1280 / 2, 720 / 2, 0.0f));
	}

	return pFade;
}

//==============================================================================================
// フェード処理
//==============================================================================================
void CFade::SetFade(CApplication::MODE mode, float fadespeed)
{
	// フェード用ポリゴンの生成
	Create();

	m_fFadeSpeed = fadespeed;

	// 次のモードの設定
	NextMode = mode;

	// フェードアウト状態にする
	FadeMode = FADE_OUT;
}
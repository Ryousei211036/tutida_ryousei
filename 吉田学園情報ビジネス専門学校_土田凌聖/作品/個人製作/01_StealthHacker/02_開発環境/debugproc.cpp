//==============================================================================================
//
// デバッグ表示　　　debugproc.cpp
// Author : 土田凌聖
//
//==============================================================================================
#include<stdarg.h>
#include"debugproc.h"
#include"application.h"
#include <tchar.h> // _T

//**********************************************************************************************
// 静的メンバ変数の宣言
//**********************************************************************************************
LPD3DXFONT CDebugProc::m_pFont = nullptr;
char CDebugProc::m_str[1024] = {};

//==============================================================================================
// コンストラクタ
//==============================================================================================
CDebugProc::CDebugProc()
{
}

//==============================================================================================
// デストラクタ
//==============================================================================================
CDebugProc::~CDebugProc()
{
}

//==============================================================================================
// 初期化処理
//==============================================================================================
void CDebugProc::Init()
{
	//デバイスの取得
	LPDIRECT3DDEVICE9 pDevice = CApplication::GetRenderer()->GetDevice();

	// デバッグ情報表示用フォントの生成
	D3DXCreateFont(pDevice, 18, 0, 0, 0, FALSE, SHIFTJIS_CHARSET,
		OUT_DEFAULT_PRECIS, DEFAULT_QUALITY, DEFAULT_PITCH, _T("Terminal"), &m_pFont);
}

//==============================================================================================
// 終了処理
//==============================================================================================
void CDebugProc::Uninit()
{
	// デバッグ情報表示用フォントの破棄
	if (m_pFont != nullptr)
	{
		m_pFont->Release();
		m_pFont = nullptr;
	}
}

//==============================================================================================
// 表示する文字列の設定
//==============================================================================================
void CDebugProc::Print(const char *pFormat, ...)
{
	char strCpy[256] = {};

	// リストの作成
	va_list args;
	va_start(args, pFormat);
	vsprintf(strCpy, pFormat, args);
	va_end(args);

	// 文字列の結合
	strcat(m_str, strCpy);
}

//==============================================================================================
// 描画処理
//==============================================================================================
void CDebugProc::Draw()
{
	RECT rect = { 0, 0,1280, 720 };

	if (m_pFont != nullptr)
	{
		m_pFont->DrawText(NULL, m_str, -1, &rect, DT_LEFT, D3DCOLOR_ARGB(0xff, 0xff, 0Xff, 0xff));
		m_str[0] = '\0';
	}
}